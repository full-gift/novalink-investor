<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#09090B">
<title>NovaLink — 掲示板</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{background:#09090B!important;height:100%}
body{background:#09090B!important;color:#EDEDEF;font-family:'Noto Sans JP',system-ui,sans-serif;min-height:100%;overflow-x:hidden;-webkit-font-smoothing:antialiased;font-size:16px;line-height:1.5}
.app{max-width:430px;margin:0 auto;min-height:100vh;background:#09090B;padding-bottom:40px}
.header{padding:calc(env(safe-area-inset-top,12px)+12px) 20px 10px;display:flex;justify-content:space-between;align-items:center}
.logo{display:flex;align-items:center;gap:10px}
.logo-mark{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,#C5963A,#DEB560);display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-weight:700;font-size:13px;color:#0A0A0C;letter-spacing:-.5px}
.logo-text{font-weight:700;font-size:17px;letter-spacing:-.02em}
.back-link{color:#C5963A;font-size:13px;font-weight:600;text-decoration:none}

.board-hd{margin:12px 20px 0;background:#111110;border:1px solid #1E1D18;border-radius:14px 14px 0 0;padding:16px 18px 12px;border-bottom:2px solid #C5963A}
.board-title{font-size:16px;font-weight:700;letter-spacing:-.01em}
.board-title em{font-style:normal;background:linear-gradient(135deg,#C5963A,#DEB560);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.board-info{display:flex;gap:16px;margin-top:6px;font-size:11px;color:#6E6E7A;font-family:'JetBrains Mono',monospace}
.board-info .live{color:#4ADE80}
.board-info .live::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:#4ADE80;margin-right:4px;vertical-align:middle}

.thread{margin:0 20px;background:#0C0C0A;border-left:1px solid #1E1D18;border-right:1px solid #1E1D18;border-bottom:1px solid #1E1D18;border-radius:0 0 14px 14px}

.post{padding:14px 16px;border-bottom:1px solid #131310}
.post:last-child{border-bottom:none}
.post-head{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.post-num{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;color:#C5963A;min-width:28px}
.post-name{font-size:12px;font-weight:600;color:#4ADE80}
.post-date{font-family:'JetBrains Mono',monospace;font-size:10px;color:#4A4A4A;margin-left:auto}
.post-id{font-family:'JetBrains Mono',monospace;font-size:10px;color:#3A3A3A}
.post-body{font-size:13.5px;line-height:1.75;color:#D4D4D8;word-break:break-word;padding-left:2px}

.notice{margin:0 20px;padding:8px 14px;font-size:11px;color:#6E6E7A;background:#0E0E0C;border-left:1px solid #1E1D18;border-right:1px solid #1E1D18;text-align:center}

.write-area{margin:16px 20px 0;background:#111110;border:1px solid #1E1D18;border-radius:14px;padding:16px}
.write-label{font-size:12px;font-weight:600;color:#6E6E7A;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.write-label .pen{color:#C5963A}
.write-box{width:100%;height:72px;background:#0A0A08;border:1px solid #1E1D18;border-radius:8px;color:#EDEDEF;font-family:'Noto Sans JP',sans-serif;font-size:14px;padding:10px 12px;outline:none;resize:none;-webkit-appearance:none;line-height:1.6}
.write-box:focus{border-color:#C5963A}
.write-box::placeholder{color:#2A2A2A}
.write-foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
.char-count{font-size:10px;color:#3A3A3A;font-family:'JetBrains Mono',monospace}
.write-btn{height:38px;padding:0 24px;border:none;border-radius:8px;background:linear-gradient(135deg,#C5963A,#DEB560);color:#0A0A0C;font-family:'Noto Sans JP',sans-serif;font-size:13px;font-weight:700;cursor:pointer;-webkit-appearance:none;transition:opacity .15s}
.write-btn:active{opacity:.82}
.write-btn:disabled{opacity:.25;cursor:default}

.sent-msg{text-align:center;padding:12px 20px;font-size:12px;color:#4ADE80;display:none}
.sent-msg.on{display:block}
.empty{text-align:center;padding:40px 20px;color:#3A3A3A;font-size:13px}
.toast{position:fixed;top:calc(env(safe-area-inset-top,12px)+16px);left:50%;transform:translateX(-50%) translateY(-100px);background:#1A2E1A;color:#4ADE80;border:1px solid #2D4A2D;font-size:14px;font-weight:600;padding:12px 24px;border-radius:14px;z-index:300;transition:transform .4s cubic-bezier(.32,.72,0,1);white-space:nowrap;max-width:88%;box-shadow:0 8px 32px rgba(0,0,0,.6)}
.toast.on{transform:translateX(-50%) translateY(0)}
.loading{text-align:center;padding:40px 20px;color:#6E6E7A;font-size:13px}
@keyframes up{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.an{animation:up .4s ease-out both}
.a1{animation-delay:.03s}.a2{animation-delay:.06s}.a3{animation-delay:.1s}
</style>
</head>
<body>
<div class="app">
<div class="toast" id="toast"></div>

<div class="header an a1">
  <div class="logo"><div class="logo-mark">NL</div><div class="logo-text">NovaLink</div></div>
  <a class="back-link" href="/">ポートフォリオ →</a>
</div>

<div class="board-hd an a2">
  <div class="board-title"><em>NovaLink</em>  株主掲示板</div>
  <div class="board-info">
    <span class="live">ACTIVE</span>
    <span id="threadCount">— res</span>
    <span>承認制</span>
  </div>
</div>
<div class="notice an a2">投稿は管理者の確認後に掲載されます。個人情報の記載はご遠慮ください。</div>

<div id="threadList"><div class="thread"><div class="loading">読み込み中...</div></div></div>

<div class="write-area an a3">
  <div class="write-label"><span class="pen">&#9998;</span> 書き込む</div>
  <textarea class="write-box" id="commentInput" placeholder="ここに本文を入力..." maxlength="500"></textarea>
  <div class="write-foot">
    <div class="char-count"><span id="charCount">0</span> / 500</div>
    <button class="write-btn" id="submitBtn" disabled>送信</button>
  </div>
</div>
<div class="sent-msg" id="sentMsg">書き込みました。管理者の承認後に掲載されます。</div>

</div>
<script>
var API=location.origin;
function $(id){return document.getElementById(id)}
function toast(m){var t=$('toast');t.textContent=m;t.classList.add('on');setTimeout(function(){t.classList.remove('on')},2800)}

var input=$('commentInput');
var charCount=$('charCount');
var submitBtn=$('submitBtn');

input.addEventListener('input',function(){
  var len=input.value.length;
  charCount.textContent=len;
  submitBtn.disabled=len===0||len>500;
});

submitBtn.addEventListener('click',async function(){
  var t=input.value.trim();
  if(!t)return;
  submitBtn.disabled=true;submitBtn.textContent='送信中...';
  try{
    await fetch(API+'/api/comments',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:t})});
    input.value='';charCount.textContent='0';
    $('sentMsg').classList.add('on');
    setTimeout(function(){$('sentMsg').classList.remove('on')},5000);
    toast('書き込みました');
  }catch(e){toast('エラーが発生しました')}
  submitBtn.textContent='送信';submitBtn.disabled=true;
});

function hashId(str){var h=0;for(var i=0;i<str.length;i++){h=((h<<5)-h)+str.charCodeAt(i);h|=0}return(Math.abs(h)%99999).toString().padStart(5,'0')}

async function loadComments(){
  try{
    var r=await(await fetch(API+'/api/comments')).json();
    $('threadCount').textContent=r.length+' res';
    if(!r.length){$('threadList').innerHTML='<div class="thread"><div class="empty">まだ書き込みはありません</div></div>';return}
    var h='<div class="thread">';
    for(var i=0;i<r.length;i++){
      var cm=r[i];
      var dt=new Date(cm.createdAt);
      var y=dt.getFullYear();var mo=String(dt.getMonth()+1).padStart(2,'0');var d=String(dt.getDate()).padStart(2,'0');
      var hh=dt.getHours();var mm=String(dt.getMinutes()).padStart(2,'0');var ss=String(dt.getSeconds()).padStart(2,'0');
      var ds=y+'/'+mo+'/'+d+' '+hh+':'+mm+':'+ss;
      var pid=hashId(cm.id+String(cm.createdAt));
      var delay=Math.min(i*0.025,0.4);
      h+='<div class="post" style="animation:up .35s ease-out '+delay+'s both">';
      h+='<div class="post-head">';
      h+='<span class="post-num">'+(r.length-i)+'</span>';
      h+='<span class="post-name">名無しの株主さん</span>';
      h+='<span class="post-date">'+ds+'</span>';
      h+='<span class="post-id">ID:'+pid+'</span>';
      h+='</div>';
      h+='<div class="post-body">'+cm.text.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')+'</div>';
      h+='</div>';
    }
    h+='</div>';
    $('threadList').innerHTML=h;
  }catch(e){$('threadList').innerHTML='<div class="thread"><div class="empty">読み込みに失敗しました</div></div>'}
}
loadComments();
</script>
</body>
</html>
